{
  "#include":  "*",

  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",

  "#variable(location)":          "#(Location)",
  "#variable(resourcegroupname)": "#(ResourceGroupName)",
  "#variable(subscription)":      "#(Subscription)",

  "variables":
  {
    "#foreach(resources[Type == 'roleassignment_apptoresource'])":
    {
      "#(Name)":  "#(bracketit(function2params('subscriptionResourceId', quoteit('Microsoft.Authorization/roleDefinitions'), quoteit(RoleDefinitionId))))"
    }
  },

  "#array(resources)": 
  {
    "#foreach(resources)": 
    {
      "#arrayitem()": 
      {
        "#callelement(Type)":
        {
          "Name":               "#(Name)",
          "#noobject":          "#(@)"
        }
      }
    }
  }
}